<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ã„ã¬ã­ã“ã‚¿ã‚¤ãƒ—è¨ºæ–­</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background: #fffaf3; }
    .question { font-size: 1.2em; margin: 1em 0; }
    .button { background: #f4a261; color: white; border: none; padding: 1em 2em; margin: 0.5em; font-size: 1em; border-radius: 10px; cursor: pointer; }
    .button:hover { background: #e57d23; }
    #question-area, #loading-area { display: none; }
  </style>
</head>
<body>
  <div id="start-area">
    <h1>ã„ã¬ã­ã“æ€§æ ¼ãƒ»ã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>
    <p>ã©ã¡ã‚‰ã®è¨ºæ–­ã‚’å—ã‘ã¾ã™ã‹ï¼Ÿ</p>
    <button class="button" onclick="startDiagnosis('dog')">ğŸ¶ çŠ¬ã‚¿ã‚¤ãƒ—è¨ºæ–­</button>
    <button class="button" onclick="startDiagnosis('cat')">ğŸ± çŒ«ã‚¿ã‚¤ãƒ—è¨ºæ–­</button>
  </div>

  <div id="question-area">
    <p id="question-text" class="question"></p>
    <button class="button" onclick="answer('ã¯ã„')">ã¯ã„</button>
    <button class="button" onclick="answer('ã„ã„ãˆ')">ã„ã„ãˆ</button>
  </div>

  <div id="loading-area">
    <p>è¨ºæ–­ä¸­ã§ã™... å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
  </div>

  <script>
    const dogQuestions = ["æœå‹ã§ã™ã‹ï¼Ÿ", "è¨ˆç”»çš„ã«å‹•ãã®ã¯å¾—æ„ï¼Ÿ", "èª°ã‹ã‚’ãƒªãƒ¼ãƒ‰ã—ãŸã„ï¼Ÿ", "æ–°ã—ã„å ´æ‰€ã¯å¥½ãï¼Ÿ", "äººã¨è©±ã™ã®ã¯å¾—æ„ï¼Ÿ", "1ã¤ã®ã“ã¨ã«é›†ä¸­ã§ãã‚‹ï¼Ÿ", "è²¬ä»»æ„ŸãŒå¼·ã„ï¼Ÿ", "å”èª¿æ€§ãŒã‚ã‚‹ï¼Ÿ", "ç´°ã‹ã„ã“ã¨ãŒæ°—ã«ãªã‚‹ï¼Ÿ", "ãƒã‚¸ãƒ†ã‚£ãƒ–ã§ã™ã‹ï¼Ÿ"];
    const catQuestions = ["ä¸€äººãŒè½ã¡ç€ãï¼Ÿ", "è¦³å¯ŸåŠ›ã«è‡ªä¿¡ãŒã‚ã‚‹ï¼Ÿ", "æ°—åˆ†å±‹ãªæ–¹ï¼Ÿ", "è¡¨æƒ…ã«å‡ºã«ãã„ï¼Ÿ", "ã‚¤ãƒ³ãƒ‰ã‚¢ãŒå¥½ãï¼Ÿ", "ç’°å¢ƒå¤‰åŒ–ã«æ•æ„Ÿï¼Ÿ", "è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’å®ˆã‚‹ï¼Ÿ", "äººè¦‹çŸ¥ã‚Šã™ã‚‹ï¼Ÿ", "æ°—é…ã‚ŠãŒå¾—æ„ï¼Ÿ", "ç†±ä¸­ã—ã‚„ã™ã„ï¼Ÿ"];
    const slugMap = {
      "æŸ´çŠ¬ã‚¿ã‚¤ãƒ—": "shiba",
      "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ—": "golden",
      "ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—": "labrador",
      "ãƒˆã‚¤ãƒ—ãƒ¼ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ—": "toypoodle",
      "ãƒ€ãƒƒã‚¯ã‚¹ãƒ•ãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—": "dachshund",
      "ä¸‰æ¯›çŒ«ã‚¿ã‚¤ãƒ—": "mike",
      "ãƒ­ã‚·ã‚¢ãƒ³ãƒ–ãƒ«ãƒ¼ã‚¿ã‚¤ãƒ—": "russianblue",
      "ãƒ©ã‚°ãƒ‰ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—": "ragdoll",
      "ãƒ™ãƒ³ã‚¬ãƒ«ã‚¿ã‚¤ãƒ—": "bengal",
      "é»’çŒ«ã‚¿ã‚¤ãƒ—": "kuroneko"
    };

    let selectedType = "dog";
    let current = 0;
    let answers = [];

    function startDiagnosis(type) {
      selectedType = type;
      document.getElementById("start-area").style.display = "none";
      document.getElementById("question-area").style.display = "block";
      showQuestion();
    }

    function showQuestion() {
      const questions = selectedType === "dog" ? dogQuestions : catQuestions;
      document.getElementById("question-text").innerText = `Q${current + 1}. ` + questions[current];
    }

    function answer(choice) {
      answers.push(choice);
      current++;
      const questions = selectedType === "dog" ? dogQuestions : catQuestions;
      if (current < questions.length) {
        showQuestion();
      } else {
        runGPT();
      }
    }

    async function runGPT() {
      document.getElementById("question-area").style.display = "none";
      document.getElementById("loading-area").style.display = "block";

      const res = await fetch("https://us-central1-inuneko-diagnosis-bot-9f4ae.cloudfunctions.net/diagnose", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ type: selectedType, answers })
      });

      const data = await res.json();
      const resultText = data.result.trim();
      const slug = slugMap[resultText];
      if (slug) {
        window.location.href = `/result/${slug}`;
      } else {
        alert("è¨ºæ–­çµæœãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚GPTå¿œç­”: " + resultText);
        location.reload();
      }
    }
  </script>
</body>
</html>
